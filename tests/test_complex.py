from typstdiff import __version__
import pytest
from typstdiff.file_converter import FileConverter
from typstdiff.iterating import Comparison
from typstdiff.main import get_file_path_without_extension
# from tests.test_complex import pytestmark
import json

# ------------------------------------------------------------
# duplicated setup and fixtures - to improve later

pytestmark = [
    pytest.mark.update,
    pytest.mark.delete,
    pytest.mark.insert,
    pytest.mark.mix
]


def perform_jsondiff_on_typst_files(old_version_file, new_version_file, diff_file):
    old_v_file = get_file_path_without_extension(old_version_file)
    new_v_file = get_file_path_without_extension(new_version_file)
    diff_file = get_file_path_without_extension(diff_file)

    file_converter = FileConverter()
    file_converter.convert_with_pandoc('typst', 'json', f'./tests/test_complex/{old_v_file}/{new_v_file}.typ', f'./tests/test_complex/{old_v_file}/{new_v_file}.json')
    file_converter.convert_with_pandoc('typst', 'json', f'./tests/test_complex/{old_v_file}/{old_v_file}.typ', f'./tests/test_complex/{old_v_file}/{old_v_file}.json')
    comparison = Comparison(f'./tests/test_complex/{old_v_file}/{new_v_file}.json', f'./tests/test_complex/{old_v_file}/{old_v_file}.json')
    comparison.parse()
    return comparison.parsed_changed_file

@pytest.fixture
def setup_files_update(request):
    filename = request.param
    old_version_file = f'test_complex/{filename}/{filename}.typ'
    new_version_file = f'test_complex/{filename}/{filename}_updated.typ'
    diff_file = f'test_complex/{filename}/{filename}_diff_updated.json'
    return old_version_file, new_version_file, diff_file

@pytest.fixture
def setup_files_delete(request):
    filename = request.param
    old_version_file = f'test_complex/{filename}/{filename}.typ'
    new_version_file = f'test_complex/{filename}/{filename}_deleted.typ'
    diff_file = f'test_complex/{filename}/{filename}_diff_deleted.json'
    return old_version_file, new_version_file, diff_file

@pytest.fixture
def setup_files_insert(request):
    filename = request.param
    old_version_file = f'test_complex/{filename}/{filename}.typ'
    new_version_file = f'test_complex/{filename}/{filename}_inserted.typ'
    diff_file = f'test_complex/{filename}/{filename}_diff_inserted.json'
    return old_version_file, new_version_file, diff_file

@pytest.fixture
def setup_files_mix(request):
    filename = request.param
    old_version_file = f'test_complex/{filename}/{filename}.typ'
    new_version_file = f'test_complex/{filename}/{filename}_mix.typ'
    diff_file = f'test_complex/{filename}/{filename}_diff_mix.json'
    return old_version_file, new_version_file, diff_file


# ------------------------------------------------------------


def create_result_files(diff_json, folder, json_filename):
    with open(f'tests/test_complex/{folder}/{json_filename}.json', 'w') as json_file:
        json.dump(diff_json, json_file)
    file_converter = FileConverter()
    file_converter.convert_with_pandoc('json', 'typst', f'./tests/test_complex/{folder}/{json_filename}.json', f'./tests/test_complex/{folder}/{json_filename}.typ')
    file_converter.compile_to_pdf(f'./tests/test_complex/{folder}/{json_filename}.typ')


@pytest.mark.parametrize('setup_files_update', ['para'], indirect=True)
@pytest.mark.update
def test_complex_update_para(setup_files_update):
    old_version_file, new_version_file, diff_file = setup_files_update
    diff_json = perform_jsondiff_on_typst_files(old_version_file, new_version_file, diff_file)
    create_result_files(diff_json, "para", "para_updated_result")

    expected_json = {"pandoc-api-version": [1, 23, 1], "meta": {}, "blocks": [{"t": "Para", "c": [{"t": "Str", "c": "In"}, {"t": "Space"}, {"t": "Str", "c": "this"}, {"t": "Space"}, {"t": "Str", "c": "report,"}, {"t": "Space"}, {"t": "Str", "c": "we"}, {"t": "Space"}, {"t": "Str", "c": "will"}, {"t": "Space"}, {"t": "Str", "c": "explore"}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "SoftBreak"}, {"t": "Str", "c": "various"}, {"t": "Space"}, {"t": "Str", "c": "factors"}, {"t": "Space"}, {"t": "Str", "c": "that"}, {"t": "Space"}, {"t": "Str", "c": "influence"}, {"t": "Space"}, {"t": "Emph", "c": [{"t": "Str", "c": "fluid"}, {"t": "SoftBreak"}, {"t": "Str", "c": "dynamics"}]}, {"t": "Space"}, {"t": "Str", "c": "in"}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "glaciers"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "changed"}]}, {"t": "Space"}, {"t": "Str", "c": "ha"}, {"t": "Space"}, {"t": "Str", "c": "they"}, {"t": "SoftBreak"}, {"t": "Str", "c": "contribute"}, {"t": "Space"}, {"t": "Str", "c": "to"}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "Space"}, {"t": "Str", "c": "formation"}, {"t": "Space"}, {"t": "Str", "c": "and"}, {"t": "SoftBreak"}, {"t": "Str", "c": "behaviour"}, {"t": "Space"}, {"t": "Str", "c": "of"}, {"t": "Space"}, {"t": "Str", "c": "these"}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "natural"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "changed"}]}, {"t": "Space"}, {"t": "Str", "c": "structures."}]}, {"t": "Para", "c": [{"t": "Str", "c": "All"}, {"t": "Space"}, {"t": "Str", "c": "manuscripts"}, {"t": "Space"}, {"t": "Str", "c": "are"}, {"t": "Space"}, {"t": "Str", "c": "to"}, {"t": "Space"}, {"t": "Str", "c": "be"}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "submitted"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "changed"}]}, {"t": "Space"}, {"t": "Str", "c": "electronically"}, {"t": "Space"}, {"t": "Str", "c": "to"}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "Space"}, {"t": "Str", "c": "ScholarOne"}, {"t": "Space"}, {"t": "Str", "c": "Abstracts"}, {"t": "Space"}, {"t": "Str", "c": "site"}, {"t": "Space"}, {"t": "Str", "c": "created"}, {"t": "Space"}, {"t": "Str", "c": "for"}, {"t": "Space"}, {"t": "Str", "c": "each"}, {"t": "Space"}, {"t": "Str", "c": "conference."}, {"t": "Space"}, {"t": "Str", "c": "The"}, {"t": "Space"}, {"t": "Str", "c": "manuscript"}, {"t": "Space"}, {"t": "Str", "c": "upload"}, {"t": "Space"}, {"t": "Str", "c": "will"}, {"t": "Space"}, {"t": "Str", "c": "be"}, {"t": "Space"}, {"t": "Str", "c": "enabled"}, {"t": "Space"}, {"t": "Str", "c": "several"}, {"t": "Space"}, {"t": "Str", "c": "weeks"}, {"t": "Space"}, {"t": "Str", "c": "after"}, {"t": "Space"}, {"t": "Str", "c": "acceptance"}, {"t": "Space"}, {"t": "Str", "c": "notices"}, {"t": "Space"}, {"t": "Str", "c": "have"}, {"t": "Space"}, {"t": "Str", "c": "been"}, {"t": "Space"}, {"t": "Str", "c": "sent."}, {"t": "Space"}, {"t": "Str", "c": "Presenting"}, {"t": "Space"}, {"t": "Str", "c": "authors"}, {"t": "Space"}, {"t": "Str", "c": "of"}, {"t": "Space"}, {"t": "Str", "c": "accepted"}, {"t": "Space"}, {"t": "Str", "c": "papers"}, {"t": "Space"}, {"t": "Str", "c": "will"}, {"t": "Space"}, {"t": "Str", "c": "receive"}, {"t": "Space"}, {"t": "Str", "c": "an"}, {"t": "Space"}, {"t": "Str", "c": "email"}, {"t": "Space"}, {"t": "Str", "c": "with"}, {"t": "Space"}, {"t": "Str", "c": "instructions"}, {"t": "Space"}, {"t": "Str", "c": "when"}, {"t": "Space"}, {"t": "Str", "c": "manuscript"}, {"t": "Space"}, {"t": "Str", "c": "submission"}, {"t": "Space"}, {"t": "Str", "c": "opens."}, {"t": "Space"}, {"t": "Str", "c": "It"}, {"t": "Space"}, {"t": "Str", "c": "is"}, {"t": "Space"}, {"t": "Str", "c": "important"}, {"t": "Space"}, {"t": "Str", "c": "that"}, {"t": "Space"}, {"t": "Str", "c": "presenting"}, {"t": "Space"}, {"t": "Str", "c": "authors"}, {"t": "Space"}, {"t": "Str", "c": "keep"}, {"t": "Space"}, {"t": "Str", "c": "their"}, {"t": "Space"}, {"t": "Str", "c": "email"}, {"t": "Space"}, {"t": "Str", "c": "addresses"}, {"t": "Space"}, {"t": "Str", "c": "up-to-date"}, {"t": "Space"}, {"t": "Str", "c": "so"}, {"t": "Space"}, {"t": "Str", "c": "they"}, {"t": "Space"}, {"t": "Str", "c": "do"}, {"t": "Space"}, {"t": "Str", "c": "not"}, {"t": "Space"}, {"t": "Str", "c": "miss"}, {"t": "Space"}, {"t": "Str", "c": "this"}, {"t": "Space"}, {"t": "Str", "c": "notice."}]}, {"t": "Para", "c": [{"t": "Str", "c": "It"}, {"t": "Space"}, {"t": "Str", "c": "is"}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "Space"}, {"t": "Str", "c": "responsibility"}, {"t": "Space"}, {"t": "Str", "c": "of"}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "author"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "changed"}]}, {"t": "Space"}, {"t": "Str", "c": "to"}, {"t": "Space"}, {"t": "Str", "c": "obtain"}, {"t": "Space"}, {"t": "Str", "c": "any"}, {"t": "Space"}, {"t": "Str", "c": "required"}, {"t": "Space"}, {"t": "Str", "c": "government"}, {"t": "Space"}, {"t": "Str", "c": "or"}, {"t": "Space"}, {"t": "Str", "c": "company"}, {"t": "Space"}, {"t": "Str", "c": "reviews"}, {"t": "Space"}, {"t": "Str", "c": "for"}, {"t": "Space"}, {"t": "Str", "c": "their"}, {"t": "Space"}, {"t": "Str", "c": "papers"}, {"t": "Space"}, {"t": "Str", "c": "in"}, {"t": "Space"}, {"t": "Str", "c": "advance"}, {"t": "Space"}, {"t": "Str", "c": "of"}, {"t": "Space"}, {"t": "Str", "c": "publication."}, {"t": "Space"}, {"t": "Str", "c": "Start"}, {"t": "Space"}, {"t": "Str", "c": "early"}, {"t": "Space"}, {"t": "Str", "c": "to"}, {"t": "Space"}, {"t": "Str", "c": "determine"}, {"t": "Space"}, {"t": "Str", "c": "if"}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "Space"}, {"t": "Str", "c": "reviews"}, {"t": "Space"}, {"t": "Str", "c": "are"}, {"t": "Space"}, {"t": "Str", "c": "required;"}, {"t": "Space"}, {"t": "Str", "c": "this"}, {"t": "Space"}, {"t": "Str", "c": "process"}, {"t": "Space"}, {"t": "Str", "c": "can"}, {"t": "Space"}, {"t": "Str", "c": "take"}, {"t": "Space"}, {"t": "Str", "c": "several"}, {"t": "Space"}, {"t": "Str", "c": "weeks."}]}]}
    assert diff_json == expected_json


@pytest.mark.parametrize('setup_files_delete', ['para'], indirect=True)
@pytest.mark.delete
def test_complex_delete_para(setup_files_delete):

    old_version_file, new_version_file, diff_file = setup_files_delete
    diff_json = perform_jsondiff_on_typst_files(old_version_file, new_version_file, diff_file)
    create_result_files(diff_json, "para", "para_deleted_result")

    expected_json = {"pandoc-api-version": [1, 23, 1], "meta": {}, "blocks": [{"t": "Para", "c": [{"t": "Str", "c": "In"}, {"t": "Space"}, {"t": "Str", "c": "this"}, {"t": "Space"}, {"t": "Str", "c": "report,"}, {"t": "Space"}, {"t": "Str", "c": "we"}, {"t": "Space"}, {"t": "Str", "c": "will"}, {"t": "Space"}, {"t": "Str", "c": "explore"}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "SoftBreak"}, {"t": "Str", "c": "various"}, {"t": "Space"}, {"t": "Str", "c": "factors"}, {"t": "Space"}, {"t": "Str", "c": "that"}, {"t": "Space"}, {"t": "Str", "c": "influence"}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Emph", "c": [{"t": "Str", "c": "fluid"}, {"t": "SoftBreak"}, {"t": "Str", "c": "dynamics"}]}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "in"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "glaciers"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "ha"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "they"}]}, {"t": "Strikeout", "c": [{"t": "SoftBreak"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "contribute"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "to"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "the"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "formation"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "and"}]}, {"t": "Strikeout", "c": [{"t": "SoftBreak"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "behaviour"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "of"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "these"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "natural"}]}, {"t": "Space"}, {"t": "Str", "c": "structures."}]}, {"t": "Para", "c": [{"t": "Strikeout", "c": [{"t": "Str", "c": "All"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "manuscripts"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "are"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "to"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "be"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "submitted"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "electronically"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "to"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "the"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "ScholarOne"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "Abstracts"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "site"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "created"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "for"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "each"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "conference."}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "The"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "manuscript"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "upload"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "will"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "be"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "enabled"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "several"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "weeks"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "after"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "acceptance"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "notices"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "have"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "been"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "sent."}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "Presenting"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "authors"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "of"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "accepted"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "papers"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "will"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "receive"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "an"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "email"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "with"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "instructions"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "when"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "manuscript"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "submission"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "opens."}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "It"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "is"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "important"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "that"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "presenting"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "authors"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "keep"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "their"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "email"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "addresses"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "up-to-date"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "so"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "they"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "do"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "not"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "miss"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "this"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "notice."}]}]}, {"t": "Para", "c": [{"t": "Str", "c": "It"}, {"t": "Space"}, {"t": "Str", "c": "is"}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "Space"}, {"t": "Str", "c": "responsibility"}, {"t": "Space"}, {"t": "Str", "c": "of"}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "Space"}, {"t": "Str", "c": "author"}, {"t": "Space"}, {"t": "Str", "c": "to"}, {"t": "Space"}, {"t": "Str", "c": "obtain"}, {"t": "Space"}, {"t": "Str", "c": "any"}, {"t": "Space"}, {"t": "Str", "c": "required"}, {"t": "Space"}, {"t": "Str", "c": "government"}, {"t": "Space"}, {"t": "Str", "c": "or"}, {"t": "Space"}, {"t": "Str", "c": "company"}, {"t": "Space"}, {"t": "Str", "c": "reviews"}, {"t": "Space"}, {"t": "Str", "c": "for"}, {"t": "Space"}, {"t": "Str", "c": "their"}, {"t": "Space"}, {"t": "Str", "c": "papers"}, {"t": "Space"}, {"t": "Str", "c": "in"}, {"t": "Space"}, {"t": "Str", "c": "advance"}, {"t": "Space"}, {"t": "Str", "c": "of"}, {"t": "Space"}, {"t": "Str", "c": "publication."}, {"t": "Space"}, {"t": "Str", "c": "Start"}, {"t": "Space"}, {"t": "Str", "c": "early"}, {"t": "Space"}, {"t": "Str", "c": "to"}, {"t": "Space"}, {"t": "Str", "c": "determine"}, {"t": "Space"}, {"t": "Str", "c": "if"}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "Space"}, {"t": "Str", "c": "reviews"}, {"t": "Space"}, {"t": "Str", "c": "are"}, {"t": "Space"}, {"t": "Str", "c": "required;"}, {"t": "Space"}, {"t": "Str", "c": "this"}, {"t": "Space"}, {"t": "Str", "c": "process"}, {"t": "Space"}, {"t": "Str", "c": "can"}, {"t": "Space"}, {"t": "Str", "c": "take"}, {"t": "Space"}, {"t": "Str", "c": "several"}, {"t": "Space"}, {"t": "Str", "c": "weeks."}]}]}
    assert diff_json == expected_json


@pytest.mark.parametrize('setup_files_insert', ['para'], indirect=True)
@pytest.mark.insert
def test_complex_insert_para(setup_files_insert):
    old_version_file, new_version_file, diff_file = setup_files_insert
    diff_json = perform_jsondiff_on_typst_files(old_version_file, new_version_file, diff_file)
    create_result_files(diff_json, "para", "para_inserted_result")

    expected_json = {"pandoc-api-version": [1, 23, 1], "meta": {}, "blocks": [{"t": "Para", "c": [{"t": "Str", "c": "In"}, {"t": "Space"}, {"t": "Str", "c": "this"}, {"t": "Space"}, {"t": "Str", "c": "report,"}, {"t": "Space"}, {"t": "Str", "c": "we"}, {"t": "Space"}, {"t": "Str", "c": "will"}, {"t": "Space"}, {"t": "Str", "c": "explore"}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "SoftBreak"}, {"t": "Str", "c": "various"}, {"t": "Space"}, {"t": "Str", "c": "factors"}, {"t": "Space"}, {"t": "Str", "c": "that"}, {"t": "Space"}, {"t": "Str", "c": "influence"}, {"t": "Space"}, {"t": "Emph", "c": [{"t": "Str", "c": "fluid"}, {"t": "SoftBreak"}, {"t": "Str", "c": "dynamics"}]}, {"t": "Space"}, {"t": "Str", "c": "in"}, {"t": "Space"}, {"t": "Str", "c": "glaciers"}, {"t": "Space"}, {"t": "Str", "c": "ha"}, {"t": "Space"}, {"t": "Str", "c": "they"}, {"t": "SoftBreak"}, {"t": "Str", "c": "contribute"}, {"t": "Space"}, {"t": "Str", "c": "to"}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "Space"}, {"t": "Str", "c": "formation"}, {"t": "Space"}, {"t": "Str", "c": "and"}, {"t": "SoftBreak"}, {"t": "Str", "c": "behaviour"}, {"t": "Space"}, {"t": "Str", "c": "of"}, {"t": "Space"}, {"t": "Str", "c": "these"}, {"t": "Space"}, {"t": "Str", "c": "natural"}, {"t": "Space"}, {"t": "Str", "c": "structures."}]}, {"t": "Para", "c": [{"t": "Underline", "c": [{"t": "Str", "c": "Something"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "new."}]}]}, {"t": "Para", "c": [{"t": "Str", "c": "All"}, {"t": "Space"}, {"t": "Str", "c": "manuscripts"}, {"t": "Space"}, {"t": "Str", "c": "are"}, {"t": "Space"}, {"t": "Str", "c": "to"}, {"t": "Space"}, {"t": "Str", "c": "be"}, {"t": "Space"}, {"t": "Str", "c": "submitted"}, {"t": "Space"}, {"t": "Str", "c": "electronically"}, {"t": "Space"}, {"t": "Str", "c": "to"}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "Space"}, {"t": "Str", "c": "ScholarOne"}, {"t": "Space"}, {"t": "Str", "c": "Abstracts"}, {"t": "Space"}, {"t": "Str", "c": "site"}, {"t": "Space"}, {"t": "Str", "c": "created"}, {"t": "Space"}, {"t": "Str", "c": "for"}, {"t": "Space"}, {"t": "Str", "c": "each"}, {"t": "Space"}, {"t": "Str", "c": "conference."}, {"t": "Space"}, {"t": "Str", "c": "The"}, {"t": "Space"}, {"t": "Str", "c": "manuscript"}, {"t": "Space"}, {"t": "Str", "c": "upload"}, {"t": "Space"}, {"t": "Str", "c": "will"}, {"t": "Space"}, {"t": "Str", "c": "be"}, {"t": "Space"}, {"t": "Str", "c": "enabled"}, {"t": "Space"}, {"t": "Str", "c": "several"}, {"t": "Space"}, {"t": "Str", "c": "weeks"}, {"t": "Space"}, {"t": "Str", "c": "after"}, {"t": "Space"}, {"t": "Str", "c": "acceptance"}, {"t": "Space"}, {"t": "Str", "c": "notices"}, {"t": "Space"}, {"t": "Str", "c": "have"}, {"t": "Space"}, {"t": "Str", "c": "been"}, {"t": "Space"}, {"t": "Str", "c": "sent."}, {"t": "Space"}, {"t": "Str", "c": "Presenting"}, {"t": "Space"}, {"t": "Str", "c": "authors"}, {"t": "Space"}, {"t": "Str", "c": "of"}, {"t": "Space"}, {"t": "Str", "c": "accepted"}, {"t": "Space"}, {"t": "Str", "c": "papers"}, {"t": "Space"}, {"t": "Str", "c": "will"}, {"t": "Space"}, {"t": "Str", "c": "receive"}, {"t": "Space"}, {"t": "Str", "c": "an"}, {"t": "Space"}, {"t": "Str", "c": "email"}, {"t": "Space"}, {"t": "Str", "c": "with"}, {"t": "Space"}, {"t": "Str", "c": "instructions"}, {"t": "Space"}, {"t": "Str", "c": "when"}, {"t": "Space"}, {"t": "Str", "c": "manuscript"}, {"t": "Space"}, {"t": "Str", "c": "submission"}, {"t": "Space"}, {"t": "Str", "c": "opens."}, {"t": "Space"}, {"t": "Str", "c": "It"}, {"t": "Space"}, {"t": "Str", "c": "is"}, {"t": "Space"}, {"t": "Str", "c": "important"}, {"t": "Space"}, {"t": "Str", "c": "that"}, {"t": "Space"}, {"t": "Str", "c": "presenting"}, {"t": "Space"}, {"t": "Str", "c": "authors"}, {"t": "Space"}, {"t": "Str", "c": "keep"}, {"t": "Space"}, {"t": "Str", "c": "their"}, {"t": "Space"}, {"t": "Str", "c": "email"}, {"t": "Space"}, {"t": "Str", "c": "addresses"}, {"t": "Space"}, {"t": "Str", "c": "up-to-date"}, {"t": "Space"}, {"t": "Str", "c": "so"}, {"t": "Space"}, {"t": "Str", "c": "they"}, {"t": "Space"}, {"t": "Str", "c": "do"}, {"t": "Space"}, {"t": "Str", "c": "not"}, {"t": "Space"}, {"t": "Str", "c": "miss"}, {"t": "Space"}, {"t": "Str", "c": "this"}, {"t": "Space"}, {"t": "Str", "c": "notice."}]}, {"t": "Para", "c": [{"t": "Str", "c": "It"}, {"t": "Space"}, {"t": "Str", "c": "is"}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "Space"}, {"t": "Str", "c": "responsibility"}, {"t": "Space"}, {"t": "Str", "c": "of"}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "Space"}, {"t": "Str", "c": "author"}, {"t": "Space"}, {"t": "Str", "c": "to"}, {"t": "Space"}, {"t": "Str", "c": "obtain"}, {"t": "Space"}, {"t": "Str", "c": "any"}, {"t": "Space"}, {"t": "Str", "c": "required"}, {"t": "Space"}, {"t": "Str", "c": "government"}, {"t": "Space"}, {"t": "Str", "c": "or"}, {"t": "Space"}, {"t": "Str", "c": "company"}, {"t": "Space"}, {"t": "Str", "c": "reviews"}, {"t": "Space"}, {"t": "Str", "c": "for"}, {"t": "Space"}, {"t": "Str", "c": "their"}, {"t": "Space"}, {"t": "Str", "c": "papers"}, {"t": "Space"}, {"t": "Str", "c": "in"}, {"t": "Space"}, {"t": "Str", "c": "advance"}, {"t": "Space"}, {"t": "Str", "c": "of"}, {"t": "Space"}, {"t": "Str", "c": "publication."}, {"t": "Space"}, {"t": "Str", "c": "Start"}, {"t": "Space"}, {"t": "Str", "c": "early"}, {"t": "Space"}, {"t": "Str", "c": "to"}, {"t": "Space"}, {"t": "Str", "c": "determine"}, {"t": "Space"}, {"t": "Str", "c": "if"}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "Space"}, {"t": "Str", "c": "reviews"}, {"t": "Space"}, {"t": "Str", "c": "are"}, {"t": "Space"}, {"t": "Str", "c": "required;"}, {"t": "Space"}, {"t": "Str", "c": "this"}, {"t": "Space"}, {"t": "Str", "c": "process"}, {"t": "Space"}, {"t": "Str", "c": "can"}, {"t": "Space"}, {"t": "Str", "c": "take"}, {"t": "Space"}, {"t": "Str", "c": "several"}, {"t": "Space"}, {"t": "Str", "c": "weeks."}]}, {"t": "Para", "c": [{"t": "Underline", "c": [{"t": "Str", "c": "New"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "paragraph."}]}]}]}
    assert diff_json == expected_json


@pytest.mark.parametrize('setup_files_mix', ['para'], indirect=True)
@pytest.mark.mix
def test_complex_mix_para(setup_files_mix):
    old_version_file, new_version_file, diff_file = setup_files_mix
    diff_json = perform_jsondiff_on_typst_files(old_version_file, new_version_file, diff_file)
    create_result_files(diff_json, "para", "para_mix_result")

    expected_json = {"pandoc-api-version": [1, 23, 1], "meta": {}, "blocks": [{"t": "Para", "c": [{"t": "Str", "c": "In"}, {"t": "Space"}, {"t": "Str", "c": "this"}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "report,"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "changed,"}]}, {"t": "Space"}, {"t": "Str", "c": "we"}, {"t": "Space"}, {"t": "Str", "c": "will"}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "explore"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "changed"}]}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "SoftBreak"}, {"t": "Str", "c": "various"}, {"t": "Space"}, {"t": "Str", "c": "factors"}, {"t": "Space"}, {"t": "Str", "c": "that"}, {"t": "Space"}, {"t": "Str", "c": "influence"}, {"t": "Space"}, {"t": "Emph", "c": [{"t": "Str", "c": "fluid"}, {"t": "SoftBreak"}, {"t": "Str", "c": "dynamics"}]}, {"t": "Space"}, {"t": "Str", "c": "in"}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "glaciers"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "ha"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "they"}]}, {"t": "Strikeout", "c": [{"t": "SoftBreak"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "contribute"}]}, {"t": "Space"}, {"t": "Str", "c": "to"}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "Space"}, {"t": "Str", "c": "formation"}, {"t": "Space"}, {"t": "Str", "c": "and"}, {"t": "SoftBreak"}, {"t": "Str", "c": "behaviour"}, {"t": "Space"}, {"t": "Str", "c": "of"}, {"t": "Space"}, {"t": "Str", "c": "these"}, {"t": "Space"}, {"t": "Str", "c": "natural"}, {"t": "Space"}, {"t": "Str", "c": "structures."}]}, {"t": "Para", "c": [{"t": "Strikeout", "c": [{"t": "Str", "c": "All"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "manuscripts"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "are"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "to"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "be"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "submitted"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "electronically"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "to"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "the"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "ScholarOne"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "Abstracts"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "site"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "created"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "for"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "each"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "conference."}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "The"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "manuscript"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "upload"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "will"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "be"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "enabled"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "several"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "weeks"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "after"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "acceptance"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "notices"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "have"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "been"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "sent."}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "Presenting"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "authors"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "of"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "accepted"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "papers"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "will"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "receive"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "an"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "email"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "with"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "instructions"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "when"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "manuscript"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "submission"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "opens."}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "It"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "is"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "important"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "that"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "presenting"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "authors"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "keep"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "their"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "email"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "addresses"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "up-to-date"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "so"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "they"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "do"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "not"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "miss"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "Something"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "this"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "new."}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "notice."}]}, {"t": "Underline", "c": [{"t": "Str", "c": "Monkey."}]}]}, {"t": "Para", "c": [{"t": "Underline", "c": [{"t": "Str", "c": "All"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "changed"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "are"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "to"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "be"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "changed"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "It"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "electronically"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "is"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "to"}]}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "site"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "created"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "for"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "each"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "conference."}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "The"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "manuscript"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "upload"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "will"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "responsibility"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "be"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "of"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "enabled"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "the"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "several"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "author"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "weeks"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "to"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "after"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "obtain"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "acceptance"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "any"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "notices"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "required"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "have"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "government"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "been"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "or"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "sent."}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "company"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "Presenting"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "reviews"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "authors"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "for"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "of"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "their"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "accepted"}]}, {"t": "Space"}, {"t": "Str", "c": "papers"}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "will"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "receive"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "an"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "email"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "with"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "instructions"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "when"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "manuscript"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "submission"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "in"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "opens."}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "advance"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "It"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "of"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "is"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "publication."}]}, {"t": "Underline", "c": [{"t": "Str", "c": "important"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "Start"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "that"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "early"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "presenting"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "to"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "authors"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "determine"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "keep"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "if"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "their"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "the"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "email"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "reviews"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "addresses"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "are"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "up-to-date"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "required;"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "so"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "this"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "they"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "process"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "do"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "can"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "not"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "take"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "miss"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "several"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "this"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "weeks."}]}, {"t": "Underline", "c": [{"t": "Str", "c": "notice."}]}]}]}
    assert diff_json == expected_json



@pytest.mark.parametrize('setup_files_update', ['ordered_list'], indirect=True)
@pytest.mark.update
def test_complex_update_ordered_list(setup_files_update):
    old_version_file, new_version_file, diff_file = setup_files_update
    diff_json = perform_jsondiff_on_typst_files(old_version_file, new_version_file, diff_file)
    create_result_files(diff_json, "ordered_list", "ordered_list_updated_result")

    expected_json = {"pandoc-api-version": [1, 23, 1], "meta": {}, "blocks": [{"t": "Para", "c": [{"t": "Str", "c": "In"}, {"t": "Space"}, {"t": "Str", "c": "this"}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "report,"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "changed,"}]}, {"t": "Space"}, {"t": "Str", "c": "we"}, {"t": "Space"}, {"t": "Str", "c": "will"}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "explore"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "changed"}]}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "SoftBreak"}, {"t": "Str", "c": "various"}, {"t": "Space"}, {"t": "Str", "c": "factors"}, {"t": "Space"}, {"t": "Str", "c": "that"}, {"t": "Space"}, {"t": "Str", "c": "influence"}, {"t": "Space"}, {"t": "Emph", "c": [{"t": "Str", "c": "fluid"}, {"t": "SoftBreak"}, {"t": "Str", "c": "dynamics"}]}, {"t": "Space"}, {"t": "Str", "c": "in"}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "glaciers"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "ha"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "they"}]}, {"t": "Strikeout", "c": [{"t": "SoftBreak"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "contribute"}]}, {"t": "Space"}, {"t": "Str", "c": "to"}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "Space"}, {"t": "Str", "c": "formation"}, {"t": "Space"}, {"t": "Str", "c": "and"}, {"t": "SoftBreak"}, {"t": "Str", "c": "behaviour"}, {"t": "Space"}, {"t": "Str", "c": "of"}, {"t": "Space"}, {"t": "Str", "c": "these"}, {"t": "Space"}, {"t": "Str", "c": "natural"}, {"t": "Space"}, {"t": "Str", "c": "structures."}]}, {"t": "Para", "c": [{"t": "Strikeout", "c": [{"t": "Str", "c": "All"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "manuscripts"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "are"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "to"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "be"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "submitted"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "electronically"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "to"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "the"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "ScholarOne"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "Abstracts"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "site"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "created"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "for"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "each"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "conference."}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "The"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "manuscript"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "upload"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "will"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "be"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "enabled"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "several"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "weeks"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "after"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "acceptance"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "notices"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "have"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "been"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "sent."}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "Presenting"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "authors"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "of"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "accepted"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "papers"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "will"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "receive"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "an"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "email"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "with"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "instructions"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "when"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "manuscript"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "submission"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "opens."}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "It"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "is"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "important"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "that"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "presenting"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "authors"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "keep"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "their"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "email"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "addresses"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "up-to-date"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "so"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "they"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "do"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "not"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "miss"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "Something"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "this"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "new."}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "notice."}]}, {"t": "Underline", "c": [{"t": "Str", "c": "Monkey."}]}]}, {"t": "Para", "c": [{"t": "Underline", "c": [{"t": "Str", "c": "All"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "changed"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "are"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "to"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "be"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "changed"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "It"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "electronically"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "is"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "to"}]}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "site"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "created"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "for"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "each"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "conference."}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "The"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "manuscript"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "upload"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "will"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "responsibility"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "be"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "of"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "enabled"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "the"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "several"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "author"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "weeks"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "to"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "after"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "obtain"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "acceptance"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "any"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "notices"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "required"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "have"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "government"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "been"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "or"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "sent."}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "company"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "Presenting"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "reviews"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "authors"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "for"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "of"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "their"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "accepted"}]}, {"t": "Space"}, {"t": "Str", "c": "papers"}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "will"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "receive"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "an"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "email"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "with"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "instructions"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "when"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "manuscript"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "submission"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "in"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "opens."}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "advance"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "It"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "of"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "is"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "publication."}]}, {"t": "Underline", "c": [{"t": "Str", "c": "important"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "Start"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "that"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "early"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "presenting"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "to"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "authors"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "determine"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "keep"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "if"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "their"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "the"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "email"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "reviews"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "addresses"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "are"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "up-to-date"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "required;"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "so"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "this"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "they"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "process"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "do"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "can"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "not"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "take"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "miss"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "several"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "this"}]}, {"t": "Space"}, {"t": "Strikeout", "c": [{"t": "Str", "c": "weeks."}]}, {"t": "Underline", "c": [{"t": "Str", "c": "notice."}]}]}]}
    assert diff_json == expected_json


@pytest.mark.parametrize('setup_files_delete', ['ordered_list'], indirect=True)
@pytest.mark.delete
def test_complex_delete_ordered_list(setup_files_delete):

    old_version_file, new_version_file, diff_file = setup_files_delete
    diff_json = perform_jsondiff_on_typst_files(old_version_file, new_version_file, diff_file)
    create_result_files(diff_json, "ordered_list", "ordered_list_deleted_result")

    expected_json = {"pandoc-api-version": [1, 23, 1], "meta": {}, "blocks": [{"t": "Para", "c": [{"t": "Str", "c": "In"}, {"t": "Space"}, {"t": "Str", "c": "this"}, {"t": "Space"}, {"t": "Str", "c": "report,"}, {"t": "Space"}, {"t": "Str", "c": "we"}, {"t": "Space"}, {"t": "Str", "c": "will"}, {"t": "Space"}, {"t": "Str", "c": "explore"}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "SoftBreak"}, {"t": "Str", "c": "various"}, {"t": "Space"}, {"t": "Str", "c": "factors"}, {"t": "Space"}, {"t": "Str", "c": "that"}, {"t": "Space"}, {"t": "Str", "c": "influence"}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Emph", "c": [{"t": "Str", "c": "fluid"}, {"t": "SoftBreak"}, {"t": "Str", "c": "dynamics"}]}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "in"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "glaciers"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "ha"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "they"}]}, {"t": "Strikeout", "c": [{"t": "SoftBreak"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "contribute"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "to"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "the"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "formation"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "and"}]}, {"t": "Strikeout", "c": [{"t": "SoftBreak"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "behaviour"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "of"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "these"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "natural"}]}, {"t": "Space"}, {"t": "Str", "c": "structures."}]}, {"t": "Para", "c": [{"t": "Strikeout", "c": [{"t": "Str", "c": "All"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "manuscripts"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "are"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "to"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "be"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "submitted"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "electronically"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "to"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "the"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "ScholarOne"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "Abstracts"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "site"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "created"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "for"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "each"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "conference."}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "The"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "manuscript"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "upload"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "will"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "be"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "enabled"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "several"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "weeks"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "after"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "acceptance"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "notices"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "have"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "been"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "sent."}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "Presenting"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "authors"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "of"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "accepted"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "papers"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "will"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "receive"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "an"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "email"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "with"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "instructions"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "when"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "manuscript"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "submission"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "opens."}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "It"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "is"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "important"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "that"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "presenting"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "authors"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "keep"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "their"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "email"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "addresses"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "up-to-date"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "so"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "they"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "do"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "not"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "miss"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "this"}]}, {"t": "Strikeout", "c": [{"t": "Space"}]}, {"t": "Strikeout", "c": [{"t": "Str", "c": "notice."}]}]}, {"t": "Para", "c": [{"t": "Str", "c": "It"}, {"t": "Space"}, {"t": "Str", "c": "is"}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "Space"}, {"t": "Str", "c": "responsibility"}, {"t": "Space"}, {"t": "Str", "c": "of"}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "Space"}, {"t": "Str", "c": "author"}, {"t": "Space"}, {"t": "Str", "c": "to"}, {"t": "Space"}, {"t": "Str", "c": "obtain"}, {"t": "Space"}, {"t": "Str", "c": "any"}, {"t": "Space"}, {"t": "Str", "c": "required"}, {"t": "Space"}, {"t": "Str", "c": "government"}, {"t": "Space"}, {"t": "Str", "c": "or"}, {"t": "Space"}, {"t": "Str", "c": "company"}, {"t": "Space"}, {"t": "Str", "c": "reviews"}, {"t": "Space"}, {"t": "Str", "c": "for"}, {"t": "Space"}, {"t": "Str", "c": "their"}, {"t": "Space"}, {"t": "Str", "c": "papers"}, {"t": "Space"}, {"t": "Str", "c": "in"}, {"t": "Space"}, {"t": "Str", "c": "advance"}, {"t": "Space"}, {"t": "Str", "c": "of"}, {"t": "Space"}, {"t": "Str", "c": "publication."}, {"t": "Space"}, {"t": "Str", "c": "Start"}, {"t": "Space"}, {"t": "Str", "c": "early"}, {"t": "Space"}, {"t": "Str", "c": "to"}, {"t": "Space"}, {"t": "Str", "c": "determine"}, {"t": "Space"}, {"t": "Str", "c": "if"}, {"t": "Space"}, {"t": "Str", "c": "the"}, {"t": "Space"}, {"t": "Str", "c": "reviews"}, {"t": "Space"}, {"t": "Str", "c": "are"}, {"t": "Space"}, {"t": "Str", "c": "required;"}, {"t": "Space"}, {"t": "Str", "c": "this"}, {"t": "Space"}, {"t": "Str", "c": "process"}, {"t": "Space"}, {"t": "Str", "c": "can"}, {"t": "Space"}, {"t": "Str", "c": "take"}, {"t": "Space"}, {"t": "Str", "c": "several"}, {"t": "Space"}, {"t": "Str", "c": "weeks."}]}]}
    assert diff_json == expected_json


@pytest.mark.parametrize('setup_files_insert', ['ordered_list'], indirect=True)
@pytest.mark.insert
def test_complex_insert_ordered_list(setup_files_insert):
    old_version_file, new_version_file, diff_file = setup_files_insert
    diff_json = perform_jsondiff_on_typst_files(old_version_file, new_version_file, diff_file)
    create_result_files(diff_json, "ordered_list", "ordered_list_inserted_result")

    expected_json = {"pandoc-api-version": [1, 23, 1], "meta": {}, "blocks": [{"t": "OrderedList", "c": [[1, {"t": "DefaultStyle"}, {"t": "DefaultDelim"}], [[{"t": "Para", "c": [{"t": "Str", "c": "The"}, {"t": "Space"}, {"t": "Str", "c": "climate"}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "intensive"}]}]}, {"t": "BulletList", "c": [[{"t": "Para", "c": [{"t": "Str", "c": "Precipitation"}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "important"}]}]}], [{"t": "Para", "c": [{"t": "Str", "c": "Temperature"}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "scales"}]}]}, {"t": "OrderedList", "c": [[1, {"t": "DefaultStyle"}, {"t": "DefaultDelim"}], [[{"t": "Para", "c": [{"t": "Str", "c": "degree"}]}, {"t": "BulletList", "c": [[{"t": "Para", "c": [{"t": "Str", "c": "hot"}]}], [{"t": "Para", "c": [{"t": "Str", "c": "cold"}]}], [{"t": "Para", "c": [{"t": "Str", "c": "warm"}]}], [{"t": "Para", "c": [{"t": "Underline", "c": [{"t": "Str", "c": "really"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "hot"}]}]}]]}], [{"t": "Para", "c": [{"t": "Str", "c": "sun"}]}], [{"t": "Para", "c": [{"t": "Underline", "c": [{"t": "Str", "c": "cloud"}]}]}], [{"t": "Para", "c": [{"t": "Underline", "c": [{"t": "Str", "c": "wind"}]}]}]]]}]]}], [{"t": "Para", "c": [{"t": "Str", "c": "The"}, {"t": "Space"}, {"t": "Str", "c": "geology"}]}], [{"t": "Para", "c": [{"t": "Underline", "c": [{"t": "Str", "c": "something"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "new"}]}]}]]]}]}
    assert diff_json == expected_json


@pytest.mark.parametrize('setup_files_mix', ['ordered_list'], indirect=True)
@pytest.mark.mix
def test_complex_mix_ordered_list(setup_files_mix):
    old_version_file, new_version_file, diff_file = setup_files_mix
    diff_json = perform_jsondiff_on_typst_files(old_version_file, new_version_file, diff_file)
    create_result_files(diff_json, "ordered_list", "ordered_list_mix_result")

    expected_json = {"pandoc-api-version": [1, 23, 1], "meta": {}, "blocks": [{"t": "OrderedList", "c": [[1, {"t": "DefaultStyle"}, {"t": "DefaultDelim"}], [[{"t": "Para", "c": [{"t": "Str", "c": "The"}, {"t": "Space"}, {"t": "Str", "c": "climate"}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "intensive"}]}]}, {"t": "BulletList", "c": [[{"t": "Para", "c": [{"t": "Str", "c": "Precipitation"}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "important"}]}]}], [{"t": "Para", "c": [{"t": "Str", "c": "Temperature"}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "scales"}]}]}, {"t": "OrderedList", "c": [[1, {"t": "DefaultStyle"}, {"t": "DefaultDelim"}], [[{"t": "Para", "c": [{"t": "Str", "c": "degree"}]}, {"t": "BulletList", "c": [[{"t": "Para", "c": [{"t": "Str", "c": "hot"}]}], [{"t": "Para", "c": [{"t": "Str", "c": "cold"}]}], [{"t": "Para", "c": [{"t": "Str", "c": "warm"}]}], [{"t": "Para", "c": [{"t": "Underline", "c": [{"t": "Str", "c": "really"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "hot"}]}]}]]}], [{"t": "Para", "c": [{"t": "Str", "c": "sun"}]}], [{"t": "Para", "c": [{"t": "Underline", "c": [{"t": "Str", "c": "cloud"}]}]}], [{"t": "Para", "c": [{"t": "Underline", "c": [{"t": "Str", "c": "wind"}]}]}]]]}]]}], [{"t": "Para", "c": [{"t": "Str", "c": "The"}, {"t": "Space"}, {"t": "Str", "c": "geology"}]}], [{"t": "Para", "c": [{"t": "Underline", "c": [{"t": "Str", "c": "something"}]}, {"t": "Underline", "c": [{"t": "Space"}]}, {"t": "Underline", "c": [{"t": "Str", "c": "new"}]}]}]]]}]}
    assert diff_json == expected_json



@pytest.mark.parametrize('setup_files_update', ['text_formats'], indirect=True)
@pytest.mark.update
def test_complex_update_text_formats(setup_files_update):
    old_version_file, new_version_file, diff_file = setup_files_update
    diff_json = perform_jsondiff_on_typst_files(old_version_file, new_version_file, diff_file)
    create_result_files(diff_json, "text_formats", "text_formats_updated_result")

    expected_json = {} # to do
    assert diff_json == expected_json


@pytest.mark.parametrize('setup_files_delete', ['text_formats'], indirect=True)
@pytest.mark.delete
def test_complex_delete_text_formats(setup_files_delete):

    old_version_file, new_version_file, diff_file = setup_files_delete
    diff_json = perform_jsondiff_on_typst_files(old_version_file, new_version_file, diff_file)
    create_result_files(diff_json, "text_formats", "text_formats_deleted_result")

    expected_json = {} # to do
    assert diff_json == expected_json


@pytest.mark.parametrize('setup_files_insert', ['text_formats'], indirect=True)
@pytest.mark.insert
def test_complex_insert_text_formats(setup_files_insert):
    old_version_file, new_version_file, diff_file = setup_files_insert
    diff_json = perform_jsondiff_on_typst_files(old_version_file, new_version_file, diff_file)
    create_result_files(diff_json, "text_formats", "text_formats_inserted_result")

    expected_json = {} # to do
    assert diff_json == expected_json


@pytest.mark.parametrize('setup_files_mix', ['text_formats'], indirect=True)
@pytest.mark.mix
def test_complex_mix_text_formats(setup_files_mix):
    old_version_file, new_version_file, diff_file = setup_files_mix
    diff_json = perform_jsondiff_on_typst_files(old_version_file, new_version_file, diff_file)
    create_result_files(diff_json, "text_formats", "text_formats_mix_result")

    expected_json = {} # to do
    assert diff_json == expected_json
